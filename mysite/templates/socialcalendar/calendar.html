{% extends "template.html" %}
{% block main %}

<script type="text/javascript" src="{{ STATIC_URL }}/js/jquery.tinyscrollbar.min.js"></script>
<script type="text/javascript" src="{{ STATIC_URL }}/timePicker/js/bootstrap-datetimepicker.min.js"></script>
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/css/tinyscrollbar.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}/timePicker/css/bootstrap-datetimepicker.min.css"/>

<script src="http://connect.facebook.net/en_US/all.js"></script>

<fb:login-button autologoutlink="true" onlogin="OnRequestPermission();">
</fb:login-button>
<script language="javascript" type="text/javascript">
window.fbAsyncInit = function() {
    FB.init({
      appId      : '329753420461644', // App ID
      channelUrl : '//localhost:8000/channel.html', // Channel File
      status     : true, // check login status
      cookie     : true, // enable cookies to allow the server to access the session
      xfbml      : true  // parse XFBML
    });

FB.getLoginStatus(function(response) {
    if (response.status === 'connected') {
        console.log("connected")
    } else if (response.status === 'not_authorized') {
        login();
    } else {
        // not_logged_in
        login();
    }
});
};

  function login() {
    FB.login(function(response) {
        if (response.authResponse) {
            // connected
        } else {
            // cancelled
        }
    });
}

function testAPI() {
    console.log('Welcome!  Fetching your information.... ');
    FB.api('/me', function(response) {
        console.log('Good to see you, ' + response.name + '.');
    });
}


  // Load the SDK Asynchronously
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));

</script>

<button name="my_full_name" onclick="ShowMyName()" value="My Name" />
<script language="javascript" type="text/javascript">
function ShowMyName() {
    FB.api('/me/friends', function(response) {
        var i = 0;
        if(response.data) {
            $.each(response.data,function(index,friend) {
//                alert(friend.name + ' has id:' + friend.id);
                i = i + 1;
            });
        } else {
            alert("Error!");
        }
        alert(i)
    });         
    }
</script>
<!---
<div class="alert alert-info">
    <p>You have a new event request from:</p>
    <div class="row-fluid">
        <div class="span4"></div>
        <div class="span2">
            <button class="btn btn-block btn-success" type="button">Accept</button>
        </div>
        <div class="span2">
            <button class="btn btn-block btn-danger" type="button">Reject</button>     
        </div>
        <div class="span4"></div>
    </div>
</div>
<div class="alert alert-info">
    <p>You have a new event request from:</p>
    <div class="row-fluid">
        <div class="span4"></div>
        <div class="span2">
            <button class="btn btn-block btn-success" type="button">Accept</button>
        </div>
        <div class="span2">
            <button class="btn btn-block btn-danger" type="button">Reject</button>     
        </div>
        <div class="span4"></div>
    </div>
</div>
-->

<div class="row">
    <div class="span1"><button type="button" id="calendarBack" class="btn btn-block btn-primary">&lt&lt</button></div>
    <div class="span1"><button type="button" id="calendarToday" class="btn btn-block btn-primary">Today</button></div>
    <div class="span1"><button type="button" id="calendarForward" class="btn btn-block btn-primary">&gt&gt</button></div>
    <div class="span6"><h4 id="weekname">{{ header }}</h4></div>
    <div class="span1"></div>
    <div class="span1"><button type="button" id="monthlyButton" class="btn btn-block btn-primary">Monthly</button></div>
    <div class="span1"><button type="button" id="weeklyButton" class="btn btn-block btn-primary">Weekly</button></div>
</div>

<div class="row">
    <div class="span12"><button id="gcal" type="button" class="btn btn-block btn-primary">Do Google Calendar Stuff</button></div>
</div>

<div class="row">
    <div class="span12"><p></p></div>
</div>

<!-- Start Week Calendar -->
<div id="weeklyCalendar">
    <table class="table table-bordered">
        <thead>
            <tr>
                <th width="5.5%"></th>
                {% for day in days %}
                <th class="headings weekly" width="13.5%">{{day.title}}</th>
                {% endfor %}
            </tr>
        </thead>
    </table>

    <div id="scrollbar1" class="noSelect">
        <div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>
        <div class="viewport">
            <div class="overview">
               <div class='dragged'></div>
                <div class="calendarTable">
                    <table>
                        <tbody>
                            {% for hour in hours %}
                            <tr class="calendarRow">
                                <td class="hourEntry" rowspan="2" width="5.5%">{{hour}}</td>
                                {% for day in days %}
                                {% if day.today %}
                                <td class="calendarEntry calendarToday" width="13.5%"></td>
                                {% else %}
                                <td class="calendarEntry" width="13.5%"></td>
                                {% endif %}
                                {% endfor %}
                            </tr>
                            <tr class="calendarRow">
                                {% for day in days %}
                                {% if day.today %}
                                <td class="calendarHalfHour calendarToday" width="13.5%"></td>
                                {% else %}
                                <td class="calendarHalfHour" width="13.5%"></td>
                                {% endif %}
                                {% endfor %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- End Week Calendar -->

<!-- Start Month Calendar -->
<div id="monthlyCalendar">
    <table class="table table-bordered">
        <thead>
            <tr>
                {% for day in monthDays %}
                    <th class="headings monthly" width="14.3%">{{day.title}}</th>
                {% endfor %}
            </tr>
        </thead>
    </table>


    <div class="calendarMonthTable">
        <table>
            <tbody>
                {% for week in monthWeeks %}
                <tr class="calendarRow">
                    {% for day in week %}
                    {% if day.thisMonth %}
                        {% if day.today %}
                            <td class="calendarMonthEntry calendarToday" width="14.3%"><div>{{day.date}}</div></td>
                        {% else %}
                            <td class="calendarMonthEntry" width="14.3%"><div>{{day.date}}</div></td>
                        {% endif %}
                    {% else %}
                        {% if day.today %}
                            <td class="calendarMonthEntry otherMonth calendarToday" width="14.3%"><div>{{day.date}}</div></td>
                        {% else %}
                            <td class="calendarMonthEntry otherMonth" width="14.3%"><div>{{day.date}}</div></td>
                        {% endif %}
                    {% endif %}
                    {% endfor %}
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- End of Month Calendar -->

<div class="row">
    <div class="span12"><p></p></div>
</div>

<div class="btn-group" data-toggle="buttons-radio">

    <div class="row">
        <div class="span3"><button type="button" class="btn btn-block btn-inverse">Time Block</button></div>
        <div class="span3"><button type="button" class="btn btn-block btn-inverse">Private</button></div>
        <div class="span3"><button type="button" class="btn btn-block btn-inverse">Public</button></div>
        <div class="span3"><button type="button" class="btn btn-block btn-inverse">Friends</button></div>
    </div>


</div>
<div class="row">
    <div class="span12"><p></p></div>
</div>

<!-- Popover -->
<div id="repeatPopover">
    "Hello World"
</div>

<!-- Modal -->
<div id="eventModal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <form>
        <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
            <h3 id="myModalLabel"><input id="eventName" class="input-block-level" type="text" placeholder="Event Name"></h3>
        </div>
        <div class="modal-body">
            <div class="row-fluid">
                <div class="span6">
                    <div id="datetimepicker" class="input-append">
                        <input id="startTime" data-format="MM/dd/yyyy HH:mm PP" type="text"></input>
                        <span class="add-on">
                            <i data-time-icon="icon-time" data-date-icon="icon-calendar"></i>
                        </span>
                    </div>
                </div>
                <div class="span6">
                    <div id="datetimepicker2" class="input-append">
                        <input id="endTime" data-format="MM/dd/yyyy HH:mm PP" type="text"></input>
                        <span class="add-on">
                            <i data-time-icon="icon-time" data-date-icon="icon-calendar"></i>
                        </span>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12">
                    <input id="eventLocation" class="input-block-level" type="text" placeholder="Event Location">
                </div>
            </div>
            <textarea id="eventDescription" class="input-block-level" placeholder="Event Description..." rows="10"></textarea>
        </div>
    </form>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
        <button class="btn btn-danger" id="deleteEvent">Delete</button>
        <button class="btn btn-primary" id="editEvent">Edit</button>
        <button class="btn btn-primary" id="createEvent">Create</button>
    </div>
</div>


<script type="text/javascript">

    var format = "{{format}}";

    $("#repeatPopover").popover()

    var clearModal = function () {
        $("#eventName").val("");
        $("#eventDescription").val("");
        $("#eventLocation").val("");
    }

    var dates = new Array();
    {% for date in dates %}
    dates.push(new Date({{ date.year }},
            {{ date.month }},
            {{ date.day }}));
    {% endfor %}
    $(document).ready(function(){

            var scrollBar = $('#scrollbar1');
            scrollBar.tinyscrollbar({wheel: 34});
            scrollBar.tinyscrollbar_update(272);


            $("#monthlyCalendar").hide();

            });


var gcal = function() {
    $.get('gcal', function (data, status) {
}, "json");
};


$("#gcal").click(gcal);



var changeFormat = function(newFormat) {
    $.get('changeFormat', {'format': newFormat}, function (data, status) {
            $("#weekname").html(data.header);
            format = newFormat;
            }, "json")};


$("#weeklyButton").click(function() {
        $("#monthlyCalendar").hide();
        $('.event').remove();
        $("#weeklyCalendar").show();
        format = "weekly"
        changeFormat("weekly");
        populateEvents();
        });
$("#monthlyButton").click(function() {
        $("#monthlyCalendar").show();
        $("#weeklyCalendar").hide();
        format = "monthly"
        changeFormat("monthly");
        populateMonthEvents();
        });
</script>

<script type="text/javascript" src="{{ STATIC_URL }}/js/draggable.js"></script>
{% endblock main %}
